<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BKO Ponto - Oficial</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #667eea; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .container { background: white; border-radius: 15px; padding: 25px; width: 100%; max-width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        h2 { text-align: center; margin-bottom: 20px; color: #333; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { width: 100%; padding: 15px; border: none; border-radius: 8px; background: #764ba2; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 16px; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #videoFeed, #photoPreview { width: 100%; border-radius: 8px; margin-top: 10px; display: none; }
        #videoFeed { transform: scaleX(-1); }
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .btn-acao { background: #f0f0f0; color: #333; font-size: 14px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
        .btn-acao.selected { background: #764ba2; color: white; border-color: #764ba2; }
        .btn-full { grid-column: span 2; }
        label { font-size: 14px; font-weight: bold; color: #555; display: block; margin-top: 15px; }
        .checkbox-group { background: #f9f9f9; padding: 12px; border-radius: 8px; margin-top: 8px; border: 1px solid #eee; }
        .checkbox-item { display: flex; align-items: center; margin-bottom: 10px; cursor: pointer; font-size: 14px; color: #444; }
        .checkbox-item input { width: 18px; height: 18px; margin-right: 10px; }
        #statusMsg { text-align: center; margin-top: 15px; font-weight: bold; }
        .user-badge { text-align: center; background: #eee; padding: 5px; border-radius: 5px; margin-bottom: 15px; font-size: 14px; font-weight: bold; color: #764ba2; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginArea">
        <h2>üîí Login BKO</h2>
        <input type="text" id="loginUser" placeholder="Seu Login (Ex: TT...)">
        <input type="password" id="loginPass" placeholder="Sua Senha">
        <button onclick="login()">Entrar</button>
    </div>

    <div id="pontoArea" style="display:none;">
        <div class="user-badge" id="userNameDisplay"></div>
        <h2>üïê Registro de Ponto</h2>
        
        <label>Selecione a A√ß√£o:</label>
        <div class="action-grid">
            <button class="btn-acao" onclick="setAcao(this, 'Entrada')">Entrada</button>
            <button class="btn-acao" onclick="setAcao(this, 'Sa√≠da')">Sa√≠da</button>
            <button class="btn-acao" onclick="setAcao(this, 'Sa√≠da Almo√ßo')">Sa√≠da Almo√ßo</button>
            <button class="btn-acao" onclick="setAcao(this, 'Retorno Almo√ßo')">Retorno Almo√ßo</button>
            <button class="btn-acao btn-full" onclick="setAcao(this, 'Atualiza√ß√£o')">üîÑ Atualiza√ß√£o de Tarefas</button>
        </div>

        <div id="cameraContainer" style="display:none;">
            <video id="videoFeed" autoplay playsinline></video>
            <img id="photoPreview">
            <button type="button" id="btnFoto" style="background:#444;" onclick="tirarFoto()">üì∏ Foto Obrigat√≥ria</button>
        </div>

        <label>Atividades realizadas:</label>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" class="ativ-check" value="Atualiza√ß√£o de planilhas"> Atualiza√ß√£o de planilhas</label>
            <label class="checkbox-item"><input type="checkbox" class="ativ-check" value="Pastas organizadas"> Pastas organizadas</label>
        </div>

        <textarea id="observacao" placeholder="Observa√ß√£o (Opcional)" oninput="validar()"></textarea>
        
        <button id="btnEnviar" onclick="enviar()" disabled>REGISTRAR AGORA</button>
        <p id="statusMsg"></p>
    </div>
</div>

<script>
    const CONFIG = {
        SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbz4vXakdBAtbpo_ABoERa-6NmqfmYNAvvo6VjXu8So6y5fWAIt1BYrdZ-PPKuVZdSrKDA/exec'
    };

    // BANCO DE DADOS DE USU√ÅRIOS ATUALIZADO
    const USUARIOS = {
        "TT762550": { senha: "Mega@26", nome: "Christ Ellen" },
        "TT728678": { senha: "Mega@26", nome: "Bruno" },
        "TT750825": { senha: "Mega@26", nome: "Tha√≠s" }
    };

    let usuarioLogado = ""; 
    let acao = ""; let foto = "";

    function login() {
        const userCode = document.getElementById('loginUser').value.toUpperCase().trim();
        const pass = document.getElementById('loginPass').value;

        if (USUARIOS[userCode] && USUARIOS[userCode].senha === pass) {
            usuarioLogado = USUARIOS[userCode].nome;
            document.getElementById('userNameDisplay').innerText = "üë§ Bem-vindo(a), " + usuarioLogado;
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('pontoArea').style.display = 'block';
        } else {
            alert("Login ou senha incorretos.");
        }
    }

    async function setAcao(btn, val) {
        document.querySelectorAll('.btn-acao').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        acao = val;
        
        const precisaFoto = (acao === 'Entrada' || acao === 'Sa√≠da');
        document.getElementById('cameraContainer').style.display = precisaFoto ? 'block' : 'none';
        foto = "";
        
        if (precisaFoto) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                document.getElementById('videoFeed').srcObject = stream;
                document.getElementById('videoFeed').style.display = 'block';
                document.getElementById('photoPreview').style.display = 'none';
            } catch (e) { alert("C√¢mera bloqueada. Permita o acesso para registrar."); }
        }
        validar();
    }

    function tirarFoto() {
        const v = document.getElementById('videoFeed');
        const canvas = document.createElement('canvas');
        canvas.width = 400; canvas.height = (v.videoHeight / v.videoWidth) * 400;
        canvas.getContext('2d').drawImage(v, 0, 0, canvas.width, canvas.height);
        foto = canvas.toDataURL('image/jpeg', 0.3);
        document.getElementById('photoPreview').src = foto;
        document.getElementById('photoPreview').style.display = 'block';
        v.style.display = 'none';
        validar();
    }

    function validar() {
        const btn = document.getElementById('btnEnviar');
        const precisaFoto = (acao === 'Entrada' || acao === 'Sa√≠da');
        const fotoOk = precisaFoto ? (foto && foto.length > 100) : true;
        btn.disabled = !(acao && fotoOk);
    }

    async function enviar() {
        const btn = document.getElementById('btnEnviar');
        const status = document.getElementById('statusMsg');
        btn.disabled = true;
        btn.innerText = "Enviando...";

        let marcadas = [];
        document.querySelectorAll('.ativ-check:checked').forEach(c => marcadas.push(c.value));

        let localFinal = "N/A";
        if (acao === 'Entrada' || acao === 'Sa√≠da') {
            localFinal = await new Promise(r => {
                navigator.geolocation.getCurrentPosition(p => r(p.coords.latitude+","+p.coords.longitude), () => r("Recusado"), {timeout: 5000});
            });
        }

        const payload = JSON.stringify({
            nome: usuarioLogado,
            acao: acao,
            atividades: marcadas.join(", ") || "Nenhuma tarefa marcada",
            observacao: document.getElementById('observacao').value || "-",
            local: localFinal,
            foto: foto
        });

        try {
            await fetch(CONFIG.SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: payload });
            status.innerHTML = "<span style='color:green'>‚úÖ REGISTRO REALIZADO!</span>";
            setTimeout(() => location.reload(), 2000);
        } catch (e) {
            status.innerHTML = "<span style='color:red'>‚ùå Erro ao enviar</span>";
            btn.disabled = false;
            btn.innerText = "REGISTRAR AGORA";
        }
    }
</script>
</body>
</html>
